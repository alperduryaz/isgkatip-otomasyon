javascript:(function(){if(document.getElementById('topluPeriyodikKontrolModal')){document.getElementById('topluPeriyodikKontrolModal').style.display='flex';document.getElementById('topluPeriyodikKontrolTextarea').focus();return;}let veri=[];function mk(u,d,t){return fetch(u,{method:'POST',headers:{'Accept':'*/*','Content-Type':'application/json','token':t,'Origin':'https://isgkatip.csgb.gov.tr','Referer':'https://isgkatip.csgb.gov.tr/surec/hizmet-sozlesme-surec'},body:JSON.stringify(d)}).then(r=>r.json())}function ts(){return new Date().toISOString().slice(0,-1)}function tm(){let d=new Date();d.setDate(d.getDate()+1);return d.toISOString()}function t180(){let d=new Date();d.setDate(d.getDate()+180);return d.toISOString()}function fn(r,p){if(!r||!r.body||!r.body.flowInstances)return null;const f=r.body.flowInstances.find(x=>x.flowInstancePage?.bsnInterFlowPgId===p);return f?f.businessInteractionFlowInstanceId:r.body.flowInstances[r.body.flowInstances.length-1]?.businessInteractionFlowInstanceId}function tm2(m){if(!m)return{t:'',b:false};let s=m.toString();const ok=s.includes('%C4%B0%C5%9Fleminiz ba%C5%9Far%C4%B1yla ger%C3%A7ekle%C5%9Ftirilmi%C5%9Ftir')||s.includes('ba%C5%9Far%C4%B1yla ger%C3%A7ekle%C5%9Ftirilmi%C5%9Ftir');s=s.replace(/Ba%C5%9Fvuruya ait bir sonraki ekranda i%C5%9Flem yapma yetkiniz olmad%C4%B1%C4%9F%C4%B1ndan ana men%C3%BCye y%C3%B6nlendirileceksiniz\.?/g,'').replace(/isg\.katip\.common\.exception\.business\.IsgBusinessException,\s*/g,'').replace(/\*\*\*/g,'').trim();if(ok)s='Ba%C5%9Far%C4%B1yla olu%C5%9Fturuldu';return{t:s,b:ok}}async function pk(v){const t=sessionStorage.getItem('token');if(!t)throw new Error('Token bulunamad%C4%B1');const{tur,sgkNo,tcKimlikNo,basKap,kaldirma,tesisat,tezgah,raf,makine,lpg,merdiven,kren,erisim}=v;let id=null,fid=null,fa='-',pa='-';const bt=tm(),et=t180();try{const s1=await mk('https://isgkatip.csgb.gov.tr/be/bsn-inter/submit',{body:{businessInteraction:{bsnInterId:tur},operationType:"ADD"}},t);if(s1.responseStatus!=='SUCCESS')throw new Error('Ba%C5%9Flatma hatas%C4%B1');id=s1.body.businessInteractionInstanceId;fid=s1.body.flowInstances?.[0]?.businessInteractionFlowInstanceId;const s2=await mk('https://isgkatip.csgb.gov.tr/be/quote/updateFlowInstance',{body:{quoteKey:{businessInteractionInstanceId:id},flowInstancePage:{bsnInterFlowInscId:fid,bsnInterFlowPgId:10143,name:"Bilgilendirme Sayfas%C4%B1",scrOrd:1,postActnStId:1101},page:{type:"isg.katip.common.dto.bsninter.BusinessInteractionPageWarningDTO",isActv:1,isLocked:false,bsnInterPgWrngId:8212,bsnInterPgId:10143,name:"Bilgilendirme Sayfas%C4%B1",businessInteractionName:"AKRED%C4%B0TE MUAYENE KURULU%C5%9EU %C4%B0LE SGK %C4%B0%C5%9EYER%C4%B0 ARASINDAK%C4%B0 PER%C4%B0YOD%C4%B0K KONTROL H%C4%B0ZMET%C4%B0 ALIMI S%C3%96ZLE%C5%9EMES%C4%B0",businessInteractionInstanceId:id},operation:{isActv:1,businessInteractionPageOperationId:26507,operationActionType:10,businessInteractionPageOperationName:"%C4%B0leri",businessInteractionPageOperationShortCode:"NEXT"}}},t);fid=fn(s2,10144);const s3=await mk('https://isgkatip.csgb.gov.tr/be/bsninter/conf/participant/hasRole',{body:{bsnInterPrtcptId:13283,rowId:sgkNo,dataTpId:280}},t);if(s3.responseStatus!=='SUCCESS')throw new Error('%C4%B0%C5%9Fyeri bulunamad%C4%B1');const fr=s3.body?.rowId||sgkNo;fa=s3.body?.title||'-';const s4=await mk('https://isgkatip.csgb.gov.tr/be/quote/updateFlowInstance',{body:{quoteKey:{businessInteractionInstanceId:id},flowInstancePage:{bsnInterFlowInscId:fid,bsnInterFlowPgId:10144,name:"S%C3%B6zle%C5%9Fme Yap%C4%B1lacak %C4%B0%C5%9Fyeri Se%C3%A7imi Sayfas%C4%B1",descr:"Participant Page",scrOrd:2,postActnStId:1101,isAutoComp:1,isPnr:1},page:{type:"isg.katip.common.dto.bsninter.participant.BusinessInteractionPageParticipantDTO",isActv:1,isLocked:false,bsnInterPgPrtcptId:6146,name:"S%C3%B6zle%C5%9Fme Yap%C4%B1lacak %C4%B0%C5%9Fyeri Se%C3%A7imi Sayfas%C4%B1",descr:"Participant Page",participants:[{isActv:1,bsnInterPgPrtcptItemId:6146,bsnInterPrtcptId:13283,participantDataTypeId:280,ruleSetId:1206,verNo:1,name:"S%C3%B6zle%C5%9Fme Yap%C4%B1lacak %C4%B0%C5%9Fyeri",participantName:"isyeri",rowId:fr,dataTpId:280}],businessInteractionName:"AKRED%C4%B0TE MUAYENE KURULU%C5%9EU %C4%B0LE SGK %C4%B0%C5%9EYER%C4%B0 ARASINDAK%C4%B0 PER%C4%B0YOD%C4%B0K KONTROL H%C4%B0ZMET%C4%B0 ALIMI S%C3%96ZLE%C5%9EMES%C4%B0",businessInteractionInstanceId:id,tarafBilgisi:fr+",280"},operation:{isActv:1,businessInteractionPageOperationId:26508,operationActionType:10,businessInteractionPageOperationName:"%C4%B0leri",businessInteractionPageOperationShortCode:"NEXT"}}},t);fid=fn(s4,10145);const s5=await mk('https://isgkatip.csgb.gov.tr/be/bsninter/conf/participant/hasRole',{body:{bsnInterPrtcptId:13282,rowId:tcKimlikNo,dataTpId:300}},t);if(s5.responseStatus!=='SUCCESS')throw new Error('Personel bulunamad%C4%B1');const pr=s5.body?.rowId||tcKimlikNo;pa=s5.body?.title||'-';const s6=await mk('https://isgkatip.csgb.gov.tr/be/quote/updateFlowInstance',{body:{quoteKey:{businessInteractionInstanceId:id},flowInstancePage:{bsnInterFlowInscId:fid,bsnInterFlowPgId:10145,name:"G%C3%B6revlendirme Yap%C4%B1lacak PK Yetkilisi Se%C3%A7im Sayfas%C4%B1",descr:"Participant Page",scrOrd:3,postActnStId:1101,isAutoComp:1,isPnr:1},page:{type:"isg.katip.common.dto.bsninter.participant.BusinessInteractionPageParticipantDTO",isActv:1,isLocked:false,bsnInterPgPrtcptId:6147,name:"G%C3%B6revlendirme Yap%C4%B1lacak PK Yetkilisi Se%C3%A7im Sayfas%C4%B1",descr:"Participant Page",participants:[{isActv:1,bsnInterPgPrtcptItemId:6147,bsnInterPrtcptId:13282,participantDataTypeId:300,ruleSetId:1205,verNo:1,name:"G%C3%B6revlendirilecek Periyodik Kontrol Yetkilisi",participantName:"kontrolpersoneli",rowId:pr,dataTpId:300}],businessInteractionName:"AKRED%C4%B0TE MUAYENE KURULU%C5%9EU %C4%B0LE SGK %C4%B0%C5%9EYER%C4%B0 ARASINDAK%C4%B0 PER%C4%B0YOD%C4%B0K KONTROL H%C4%B0ZMET%C4%B0 ALIMI S%C3%96ZLE%C5%9EMES%C4%B0",businessInteractionInstanceId:id,tarafBilgisi:fr+",280"},operation:{isActv:1,businessInteractionPageOperationId:26509,operationActionType:10,businessInteractionPageOperationName:"%C4%B0leri",businessInteractionPageOperationShortCode:"NEXT"}}},t);fid=fn(s6,10146);const ct=ts();const cc=(i,l,tg,vl)=>({isActv:1,cdate:ct,cuser:5675110,uuser:5675110,bsnInterPgCharId:i,bsnInterPgLytId:l,charId:tg==="bastar"||tg==="bittar"?22:1,name:"",isOvrdn:0,isOpt:0,tag:tg,isLocked:0,comments:[],gnlChar:{isActv:1,charId:tg==="bastar"||tg==="bittar"?22:1,name:tg==="bastar"||tg==="bittar"?"KISA TARIH ALANI":"NUMERIK ALAN",shrtCode:tg==="bastar"||tg==="bittar"?"KS_TRH":"GNL_CHAR_1",valTpId:tg==="bastar"||tg==="bittar"?12:10,valDispHintId:tg==="bastar"||tg==="bittar"?721:722,regExprId:tg==="bastar"||tg==="bittar"?undefined:1000,isSyst:1,valueList:[],valueDisplayHint:{isActv:1,gnlTpId:tg==="bastar"||tg==="bittar"?721:722,name:tg==="bastar"||tg==="bittar"?"Date Input":"Number Input",shrtCode:tg==="bastar"||tg==="bittar"?"DATE":"INT"},valueType:{isActv:1,gnlTpId:tg==="bastar"||tg==="bittar"?12:10,name:tg==="bastar"||tg==="bittar"?"Date":"Number",shrtCode:tg==="bastar"||tg==="bittar"?"DATE":"INT"}},historyCapturedGeneralChars:[],capturedValue:{capturedValueList:[{val:vl,charId:tg==="bastar"||tg==="bittar"?22:1}]}});const s7=await mk('https://isgkatip.csgb.gov.tr/be/quote/updateFlowInstance',{body:{quoteKey:{businessInteractionInstanceId:id},flowInstancePage:{bsnInterFlowInscId:fid,bsnInterFlowPgId:10146,name:"S%C3%B6zle%C5%9Fme Bilgileri Giri%C5%9F Sayfas%C4%B1",scrOrd:4,postActnStId:1101},page:{type:"isg.katip.common.dto.bsninter.BusinessInteractionPageFormDTO",isActv:1,cdate:ct,cuser:5675110,isLocked:false,bsnInterPgFormId:7212,bsnInterPgId:10146,name:"S%C3%B6zle%C5%9Fme Bilgileri Giri%C5%9F Sayfas%C4%B1",descr:"Form Initialize Page",businessInteractionPageLayouts:[{isActv:1,bsnInterPgLytId:7229,bsnInterPgFormId:7212,name:"G%C3%B6revlendirme Bilgileri",businessInteractionPageChars:[cc(8589,7229,"bastar",bt),cc(8590,7229,"bittar",et)]},{isActv:1,bsnInterPgLytId:7230,bsnInterPgFormId:7212,name:"Rapor D%C3%BCzenlenecek Ekipman Bilgileri",businessInteractionPageChars:[cc(8591,7230,"bas_kap_say",basKap),cc(8592,7230,"kal_ekip_say",kaldirma),cc(8593,7230,"tes_say",tesisat),cc(8594,7230,"tez_say",tezgah),cc(8595,7230,"end_raf_say",raf),cc(8596,7230,"is_mak_say",makine)]},{isActv:1,bsnInterPgLytId:7231,bsnInterPgFormId:7212,name:"Rapor D%C3%BCzenlenecek Akreditasyona Tabi Ekipman Bilgileri",businessInteractionPageChars:[cc(8597,7231,"lpg_say",lpg),cc(8598,7231,"yur_mer_say",merdiven),cc(8599,7231,"kren_say",kren),cc(8600,7231,"asi_eri_say",erisim)]}],businessInteractionName:"AKRED%C4%B0TE MUAYENE KURULU%C5%9EU %C4%B0LE SGK %C4%B0%C5%9EYER%C4%B0 ARASINDAK%C4%B0 PER%C4%B0YOD%C4%B0K KONTROL H%C4%B0ZMET%C4%B0 ALIMI S%C3%96ZLE%C5%9EMES%C4%B0",businessInteractionInstanceId:id,tags:{bastar:bt,bittar:et,bas_kap_say:basKap,kal_ekip_say:kaldirma,tes_say:tesisat,tez_say:tezgah,end_raf_say:raf,is_mak_say:makine,lpg_say:lpg,yur_mer_say:merdiven,kren_say:kren,asi_eri_say:erisim}},operation:{isActv:1,cdate:ct,cuser:5675110,uuser:5675110,businessInteractionPageOperationId:26510,operationActionType:10,businessInteractionPageOperationName:"%C4%B0leri",businessInteractionPageOperationShortCode:"NEXT"}}},t);const rs=tm2(JSON.stringify(s7));if(!rs.b)throw new Error(rs.t||'Form hatas%C4%B1');veri.push({tur,fa,sgkNo,pa,tcKimlikNo,bt:bt.split('T')[0],et:et.split('T')[0],m:'Ba%C5%9Far%C4%B1yla olu%C5%9Fturuldu'});return{basarili:true,tur,sgkNo,tcKimlik:tcKimlikNo,instanceId:id,fa,pa}}catch(e){throw e}}function vl(tx){const ls=tx.split('\n').filter(l=>l.trim()!=='');const r={v:[],iv:[],t:ls.length};ls.forEach((l,i)=>{const ln=i+1;const ps=l.split(';');if(ps.length!==13){r.iv.push({l:ln,d:l,e:'13 alan olmal%C4%B1'});return}const[tur,sgk,tc,bk,kl,ts,tz,rf,mk,lp,mr,kr,er]=ps.map(p=>p.trim());const es=[];if(!/^\d+$/.test(tur))es.push('T%C3%BCr say%C4%B1 olmal%C4%B1');if(!/^\d{26}$/.test(sgk))es.push('SGK 26 hane');if(!/^\d{11}$/.test(tc))es.push('TC 11 hane');[bk,kl,ts,tz,rf,mk,lp,mr,kr,er].forEach((e,x)=>{if(!/^\d+$/.test(e))es.push(['BasKap','Kald%C4%B1rma','Tesisat','Tezgah','Raf','Makine','LPG','Merdiven','Kren','Eri%C5%9Fim'][x]+' say%C4%B1 olmal%C4%B1')});if(es.length===0){r.v.push({l:ln,d:l,tur,sgkNo:sgk,tcKimlikNo:tc,basKap:bk,kaldirma:kl,tesisat:ts,tezgah:tz,raf:rf,makine:mk,lpg:lp,merdiven:mr,kren:kr,erisim:er})}else{r.iv.push({l:ln,d:l,e:es.join(', ')})}});return r}const m=document.createElement('div');m.id='topluPeriyodikKontrolModal';m.style.cssText='display:flex !important;position:fixed !important;top:0 !important;left:0 !important;width:100% !important;height:100% !important;background-color:rgba(0,0,0,0.6) !important;z-index:10001 !important;justify-content:center !important;align-items:center !important';const mc=document.createElement('div');mc.style.cssText='background-color:white !important;padding:25px !important;border-radius:8px !important;width:900px !important;max-width:95% !important;max-height:90% !important;overflow-y:auto !important;box-shadow:0 4px 20px rgba(0,0,0,0.3) !important;font-family:Arial,sans-serif !important';const tt=document.createElement('h3');tt.textContent='Toplu Periyodik Kontrol Giri%C5%9Fi';tt.style.cssText='margin-top:0 !important;margin-bottom:15px !important;color:#333 !important;border-bottom:2px solid #17a2b8 !important;padding-bottom:10px !important;font-size:18px !important';const fi=document.createElement('div');fi.innerHTML='<div style="background:#f8f9fa;padding:10px;border-radius:4px;margin-bottom:15px;font-size:12px;color:#666"><strong>Format:</strong> T%C3%BCr;SGKNo;TCKimlikNo;BasKap;Kald%C4%B1rma;Tesisat;Tezgah;Raf;Makine;LPG;Merdiven;Kren;Eri%C5%9Fim<br><strong>%C3%96rnek:</strong> 322;22790020210914150411180000;20560964710;1;2;3;4;5;6;7;8;9;10</div>';const ta=document.createElement('textarea');ta.id='topluPeriyodikKontrolTextarea';ta.placeholder='%C3%96rnek:\n322;22790020210914150411180000;20560964710;1;2;3;4;5;6;7;8;9;10';ta.style.cssText='width:100% !important;height:250px !important;margin-bottom:20px !important;padding:12px !important;border:1px solid #ddd !important;border-radius:4px !important;resize:vertical !important;font-family:"Courier New",monospace !important;font-size:14px !important;box-sizing:border-box !important';const rd=document.createElement('div');rd.id='validationResults';rd.style.cssText='margin-bottom:20px !important;padding:15px !important;border-radius:4px !important;display:none !important;max-height:200px !important;overflow-y:auto !important';const pd=document.createElement('div');pd.id='progressDiv';pd.style.cssText='margin-bottom:20px !important;padding:15px !important;border-radius:4px !important;display:none !important;background:#e9ecef !important;font-size:14px !important;max-height:300px !important;overflow-y:auto !important';const bc=document.createElement('div');bc.style.cssText='display:flex !important;gap:10px !important;justify-content:space-between !important';const lb=document.createElement('div');lb.style.cssText='display:flex !important;gap:10px !important';const rb=document.createElement('div');rb.style.cssText='display:flex !important;gap:10px !important';const kb=document.createElement('button');kb.innerHTML='Kontrol Et';kb.style.cssText='padding:10px 20px !important;background-color:#28a745 !important;color:white !important;border:none !important;border-radius:4px !important;cursor:pointer !important;font-size:14px !important;font-weight:bold !important';const kyb=document.createElement('button');kyb.innerHTML='Toplu Kay%C4%B1t Gir';kyb.id='topluKayitBtn';kyb.style.cssText='padding:10px 20px !important;background-color:#17a2b8 !important;color:white !important;border:none !important;border-radius:4px !important;cursor:pointer !important;font-size:14px !important;font-weight:bold !important';const ckb=document.createElement('button');ckb.innerHTML='%C3%87%C4%B1k%C4%B1%C5%9F';ckb.style.cssText='padding:10px 20px !important;background-color:#6c757d !important;color:white !important;border:none !important;border-radius:4px !important;cursor:pointer !important;font-size:14px !important;font-weight:bold !important';lb.appendChild(kb);lb.appendChild(kyb);rb.appendChild(ckb);bc.appendChild(lb);bc.appendChild(rb);mc.appendChild(tt);mc.appendChild(fi);mc.appendChild(ta);mc.appendChild(rd);mc.appendChild(pd);mc.appendChild(bc);m.appendChild(mc);document.body.appendChild(m);ta.focus();ckb.addEventListener('click',()=>m.style.display='none');kb.addEventListener('click',function(){const v=ta.value.trim();if(!v){alert('Veri giriniz');return}const vr=vl(v);rd.style.display='block';if(vr.iv.length===0){rd.style.backgroundColor='#d4edda';rd.style.color='#155724';rd.style.border='1px solid #c3e6cb';rd.innerHTML=`<strong>%E2%9C%85 Ge%C3%A7erli!</strong><br>Toplam: ${vr.t}<br>Ge%C3%A7erli: ${vr.v.length}<br>Hatal%C4%B1: ${vr.iv.length}`}else{rd.style.backgroundColor='#f8d7da';rd.style.color='#721c24';rd.style.border='1px solid #f5c6cb';let h=`<strong>%E2%9D%8C Hata!</strong><br>Toplam: ${vr.t}<br>Ge%C3%A7erli: ${vr.v.length}<br>Hatal%C4%B1: ${vr.iv.length}<br><br>`;vr.iv.forEach(i=>h+=`<div style="margin:5px 0;padding:5px;background:#fff;border-radius:3px"><strong>Sat%C4%B1r ${i.l}:</strong> ${i.d}<br><span style="color:#dc3545;font-size:12px">${i.e}</span></div>`);rd.innerHTML=h}});kyb.addEventListener('click',async function(){const v=ta.value.trim();if(!v){alert('Veri giriniz');return}const vr=vl(v);if(vr.iv.length>0){alert('Hatal%C4%B1 veri var!');return}if(!confirm(`${vr.v.length} kay%C4%B1t yap%C4%B1lacak. Devam?`))return;kyb.disabled=true;kyb.innerHTML='%C4%B0%C5%9Flem yap%C4%B1l%C4%B1yor...';veri=[];pd.style.display='block';pd.innerHTML=`<strong>Ba%C5%9Flat%C4%B1ld%C4%B1...</strong><br>Toplam: ${vr.v.length}`;const sn=[];for(let i=0;i<vr.v.length;i++){const vv=vr.v[i];try{pd.innerHTML=`<strong>%C4%B0%C5%9Flem yap%C4%B1l%C4%B1yor...</strong><br>${i+1}/${vr.v.length}<br>T%C3%BCr: ${vv.tur} - SGK: ${vv.sgkNo}`;const s=await pk(vv);sn.push(s);await new Promise(res=>setTimeout(res,2000))}catch(e){const ha=tm2(e.message);sn.push({satir:i+1,veri:vv,hata:ha.t,basarili:ha.b});veri.push({tur:vv.tur,fa:'-',sgkNo:vv.sgkNo,pa:'-',tcKimlikNo:vv.tcKimlikNo,bt:'-',et:'-',m:ha.t})}}const ok=sn.filter(s=>s.basarili).length;const nk=sn.filter(s=>!s.basarili).length;let rp=`<strong>%F0%9F%93%8A TAMAMLANDI</strong><br>%E2%9C%85 Ba%C5%9Far%C4%B1l%C4%B1: ${ok}<br>%E2%9D%8C Hata: ${nk}<br><br>`;sn.forEach((s,i)=>{if(s.basarili){const faa=s.fa||s.veri?.sgkNo||'N/A';const paa=s.pa||s.veri?.tcKimlikNo||'N/A';rp+=`<div style="margin:2px 0;padding:3px;background:#d4edda;border-radius:3px">${i+1}. %E2%9C%85 ${faa} - ${paa} (ID: ${s.instanceId||'OK'})</div>`}else{rp+=`<div style="margin:2px 0;padding:3px;background:#f8d7da;border-radius:3px">${i+1}. %E2%9D%8C ${s.veri.sgkNo} - HATA: ${s.hata}</div>`}});pd.style.backgroundColor=nk===0?'#d4edda':'#fff3cd';pd.innerHTML=rp;kyb.disabled=false;kyb.innerHTML='Toplu Kay%C4%B1t Gir';alert(`Tamamland%C4%B1!\n%E2%9C%85 Ba%C5%9Far%C4%B1l%C4%B1: ${ok}\n%E2%9D%8C Hata: ${nk}`)});m.addEventListener('click',e=>{if(e.target===m)m.style.display='none'});document.addEventListener('keydown',e=>{if(e.key==='Escape'&&m.style.display==='flex')m.style.display='none'})})();
